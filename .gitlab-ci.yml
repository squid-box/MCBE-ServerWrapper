variables:
  VER_PREFIX: '1.1.0'
  EXE_RELEASE_FOLDER: 'Stage/Release'

stages:
  - build

windows:
  stage: 'build'
  dependencies: []
  script:
    - dotnet publish --configuration Release --nologo -p:PublishReadyToRun=true  -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true -p:Version=$VER_PREFIX.$CI_PIPELINE_IID --runtime win-x64
    - cp "$EXE_RELEASE_FOLDER/win-x64/publish/MCBSW.exe" MCBSW.exe
  artifacts:
    name: 'mcbsw-win64_$VER_PREFIX.$CI_PIPELINE_IID'
    when: on_success
    paths:
      - 'MCBSW.exe'

linux:
  stage: 'build'
  dependencies: []
  script:
    - dotnet publish --configuration Release --nologo -p:PublishReadyToRun=false -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true -p:Version=$VER_PREFIX.$CI_PIPELINE_IID --runtime linux-x64
    - cp "$EXE_RELEASE_FOLDER/linux-x64/publish/MCBSW" mcbsw
  artifacts:
    name: 'mcbsw-linux64_$VER_PREFIX.$CI_PIPELINE_IID'
    when: on_success
    paths:
      - 'mcbsw'